# Content  
- Install ros and build the environment of AFV on new computer  
- Install [ceres solver](http://ceres-solver.org/installation.html#linux)
```bash shell
sudo apt-get update
# CMake
sudo apt-get install cmake
# google-glog + gflags
sudo apt-get install libgoogle-glog-dev libgflags-dev
# Use ATLAS for BLAS & LAPACK
sudo apt-get install libatlas-base-dev
# Eigen3
sudo apt-get install libeigen3-dev
# SuiteSparse (optional)
sudo apt-get install libsuitesparse-dev

git clone https://ceres-solver.googlesource.com/ceres-solver
mkdir ceres-bin
cd ceres-bin
cmake ..
make -j3
make test
# Optionally install Ceres, it can also be exported using CMake which
# allows Ceres to be used without requiring installation, see the documentation
# for the EXPORT_BUILD_DIR option for more information.
make install
```   
- Install [nlopt](https://github.com/stevengj/nlopt)
```bash shell
git clone https://github.com/stevengj/nlopt.git
cd nlopt
mkdir build
cd build
cmake ..
make
sudo make install
```
- Install other dependencies
```bash shell
sudo apt-get install libspdlog-dev
sudo apt-get install libdw-dev
sudo apt-get install libgeographic-*
sudo apt-get install geographiclib-*
sudo apt-get install ros-$ROS_DISTRO-serial
sudo apt-get install ros-$ROS_DISTRO-geographic-*
sudo apt-get install ros-$ROS_DISTRO-navigation
sudo apt-get install ros-$ROS_DISTRO-sound-play
```
- Fix conflicting declaration ‘typedef struct LZ4_stream_t LZ4_stream_t’   
```bash shell
sudo mv /usr/include/flann/ext/lz4.h /usr/include/flann/ext/lz4.h.bak   
sudo mv /usr/include/flann/ext/lz4hc.h /usr/include/flann/ext/lz4.h.bak 
sudo ln -s /usr/include/lz4hc.h /usr/include/flann/ext/lz4hc.h  
sudo ln -s /usr/include/lz4.h /usr/include/flann/ext/lz4.h   
```
## Reference  
## Bug fixes  
- Fix ```port 22: Connection refused```
	- [Instruction - How to Fix the SSH “Connection Refused” Error on Linux](https://www.makeuseof.com/fix-ssh-connection-refused-error-linux/)   
	- ```sudo apt install openssh-server```
	- ```sudo systemctl start sshd```
	- ```sudo ufw disable```
	- ```sudo ufw allow 5555```
	- ```sudo ufw allow ssh```
- when compile afv_sensors    
	- Fix ```Could not find a package configuration file provided by "Ceres" with any of the following names: CeresConfig.cmake ceres-config.cmake```    
		- Follow [Instruction - installation of ceres solver](http://ceres-solver.org/installation.html#linux)    
	- Upgrade cmake version
		- [Instruction - How do I install the latest version of cmake from the command line?](https://askubuntu.com/questions/355565/how-do-i-install-the-latest-version-of-cmake-from-the-command-line)
		- [Instruction - How to reinstall the latest cmake version?](https://stackoverflow.com/questions/49859457/how-to-reinstall-the-latest-cmake-version)   
		- ```pip install --upgrade cmake```
	- Fix ```-bash: /usr/bin/cmake: No such file or directory```
		- [Instruction -bash: /usr/bin/cmake: No such file or directory错误](https://blog.csdn.net/kongkongqixi/article/details/88657508)
		- ```cp ./cmake-3.x/bin/cmake /usr/bin/```   
	- Fix ```ImportError: No module named skbuild```    
		- [Instruction - 報錯：ImportError: No module named skbuild](https://blog.csdn.net/GungnirsPledge/article/details/108566415)   
		- ```pip install --upgrade pip```
	- Fix ```Cannot specify link libraries for target "glog::glog" which is not built by this project.```
		- Build the glog by cmake  
		- Solved after upgrade cmake version
	- Fix ```Could NOT find NLOPT (missing: NLOPT_INCLUDE_DIR NLOPT_LIBRARY)```
		- Follow [Instruction - NLopt Installation/](https://nlopt.readthedocs.io/en/latest/NLopt_Installation/)   
		- [Stackoverflow - Nlopt libraries not find on Ubuntu (WSL)](https://stackoverflow.com/questions/61842193/nlopt-libraries-not-find-on-ubuntu-wsl)   
	- Fix ```Could not find a package configuration file provided by "spdlog" with any of the following names: spdlogConfig.cmake spdlog-config.cmake```
		- [Github issue - Could not find a package configuration file provided by "spdlog" #610](https://github.com/gerbera/gerbera/issues/610)   
		- ```sudo apt-get install libspdlog-dev```   
	- Fix ```Could not find a package configuration file provided by "serial" with any of the following names: serialConfig.cmake serial-config.cmake```
		- [CDSN - CMake Error： Could not find a package configuration file provided by “serial“](https://blog.csdn.net/Will_Ye/article/details/117153462)
		- ```sudo apt-get install ros-melodic-serial```
	- Fix ``` fatal error: elfutils/libdw.h: No such file or directory #include <elfutils/libdw.h>```
		- [CDSN - ubuntu编译camera_model报错：fatal error: elfutils/libdw.h: 没有那个文件或目录](https://blog.csdn.net/weixin_46398948/article/details/120544589)
		- ```sudo apt-get install libdw-dev```
	- Fix ```error: conflicting declaration ‘typedef struct LZ4_stream_t LZ4_stream_t’```
		- [Github issue - Building error with catin build #16](https://github.com/ethz-asl/lidar_align/issues/16)
		- ```sudo mv /usr/include/flann/ext/lz4.h /usr/include/flann/ext/lz4.h.bak```
		- ```sudo mv /usr/include/flann/ext/lz4hc.h /usr/include/flann/ext/lz4.h.bak```
		- ```sudo ln -s /usr/include/lz4hc.h /usr/include/flann/ext/lz4hc.h```
		- ```sudo ln -s /usr/include/lz4.h /usr/include/flann/ext/lz4.h```
- when compile feature/afv_mln
	- Fix ```Could NOT find GeographicLib (missing: GeographicLib_LIBRARIES GeographicLib_INCLUDE_DIRS)```
		- [CDSN - GeographicLib编译踩坑笔记](https://blog.csdn.net/liuerin/article/details/116035470)
		- ```sudo apt-get install libgeographic-*```
		- ```sudo apt-get install geographiclib-*```
		- ```sudo apt-get install ros-melodic-geographic-*```
	- Fix ```Could not find a package configuration file provided by "move_base_msgs" with any of the following names: move_base_msgsConfig.cmake move_base_msgs-config.cmake```
		- ```sudo apt-get install ros-$ROS_DISTRO_navigation```
	- Fix ```sound_player.cpp:2:10: fatal error: sound_play/sound_play.h: No such file or directory #include <sound_play/sound_play.h>```
		- ```sudo apt-get install ros-$ROS_DISTRO-sound-play```
# Working time  
- 9:00 - 12:00
- 13:00 - 18:00